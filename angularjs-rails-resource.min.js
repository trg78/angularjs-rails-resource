/**
 * A resource factory inspired by $resource from AngularJS
 * @version v2.3.1 - 2018-02-11
 * @link https://github.com/FineLinePrototyping/angularjs-rails-resource.git
 * @author 
 */

angular.module("rails",["ng"]),angular.module("rails").factory("RailsInflector",function(){return{camelize:function(t){return angular.isString(t)?t.replace(/_[\w\d]/g,function(t,e,r){return 0===e?t:r.charAt(e+1).toUpperCase()}):t},underscore:function(t){return angular.isString(t)?t.replace(/[A-Z]/g,function(t,e){return 0===e?t:"_"+t.toLowerCase()}):t},pluralize:function(t){return t+"s"}}}),function(t){angular.module("rails").factory("RailsResourceInjector",["$injector",function(e){function r(r){return r?angular.isString(r)?e.get(r):r:t}function n(n){return n?e.instantiate(r(n)):t}return{createService:n,getService:function(e){return angular.isObject(e)?e:e?n(e):t},getDependency:r}}])}(),angular.module("rails").factory("railsUrlBuilder",["$interpolate",function(t){return function(e){var r,n=e.url,i=e.idAttribute;return angular.isFunction(n)||angular.isUndefined(n)?n:(e.singular||-1!==n.indexOf(t.startSymbol())||(n=n+"/"+t.startSymbol()+i+t.endSymbol()),r=t(n),function(t){return"/"===(n=r(t)).charAt(n.length-1)&&(n=n.substr(0,n.length-1)),n})}}]),function(t){angular.module("rails").provider("railsSerializer",function(){var e={underscore:t,camelize:t,pluralize:t,exclusionMatchers:[]};this.underscore=function(t){return e.underscore=t,this},this.camelize=function(t){return e.camelize=t,this},this.pluralize=function(t){return e.pluralize=t,this},this.exclusionMatchers=function(t){return e.exclusionMatchers=t,this},this.$get=["$injector","RailsInflector","RailsResourceInjector",function(r,n,i){function s(r,n){function s(){angular.isFunction(r)&&(n=r,r={}),this.exclusions={},this.inclusions={},this.serializeMappings={},this.deserializeMappings={},this.customSerializedAttributes={},this.preservedAttributes={},this.customSerializers={},this.nestedResources={},this.polymorphics={},this.options=angular.extend({excludeByDefault:!1},e,r||{}),n&&n.call(this,this)}return s.prototype.exclude=function(){var t=this.exclusions;return angular.forEach(arguments,function(e){t[e]=!1}),this},s.prototype.only=function(){var t=this.inclusions;return this.options.excludeByDefault=!0,angular.forEach(arguments,function(e){t[e]=!0}),this},s.prototype.nestedAttribute=function(){var t=this;return angular.forEach(arguments,function(e){t.rename(e,e+"_attributes")}),this},s.prototype.resource=function(t,e,r){return this.nestedResources[t]=e,r&&this.serializeWith(t,r),this},s.prototype.polymorphic=function(){var t=this.polymorphics;return angular.forEach(arguments,function(e){t[e]=!0}),this},s.prototype.rename=function(e,r,n){return this.serializeMappings[e]=r,(n||n===t)&&(this.deserializeMappings[r]=e),this},s.prototype.add=function(t,e){return this.customSerializedAttributes[t]=e,this},s.prototype.preserve=function(t){return this.preservedAttributes[t]=!0,this},s.prototype.serializeWith=function(t,e){return this.customSerializers[t]=e,this},s.prototype.isExcludedFromSerialization=function(e){if(this.options.excludeByDefault&&!this.inclusions.hasOwnProperty(e)||this.exclusions.hasOwnProperty(e))return!0;if(this.options.exclusionMatchers){var r=!1;return angular.forEach(this.options.exclusionMatchers,function(n){angular.isString(n)?r=r||0===e.indexOf(n):angular.isFunction(n)?r=r||n.call(t,e):n instanceof RegExp&&(r=r||n.test(e))}),r}return!1},s.prototype.getSerializedAttributeName=function(e){var r=this.serializeMappings[e]||e,n=this.isExcludedFromSerialization(r),i=this.isExcludedFromSerialization(e);if(this.options.excludeByDefault){if(n&&i)return t}else if(n||i)return t;return this.underscore(r)},s.prototype.isExcludedFromDeserialization=function(t){return!1},s.prototype.getDeserializedAttributeName=function(e){var r=this.camelize(e);return r=this.deserializeMappings[e]||this.deserializeMappings[r]||r,this.isExcludedFromDeserialization(e)||this.isExcludedFromDeserialization(r)?t:r},s.prototype.getNestedResource=function(t,e){var r;return r=this.polymorphics[t]?e[t+"_type"]:this.nestedResources[t],i.getDependency(r)},s.prototype.getAttributeSerializer=function(e,r){var n=this.getNestedResource(e,r),s=this.customSerializers[e];return s?i.createService(s):n?n.config.serializer:t},s.prototype.serializeData=function(t){var e=t,r=this;if(angular.isArray(t))e=[],angular.forEach(t,function(t){e.push(r.serializeData(t))});else if(angular.isObject(t)){if(angular.isDate(t))return t;e={},this.serializeObject(e,t)}return e},s.prototype.serializeObject=function(t,e){var r=this;return angular.forEach(e,function(n,i){angular.isFunction(n)||r.serializeAttribute(t,i,n,e)}),e},s.prototype.serializeAttribute=function(e,r,n,i){var s=this.getAttributeSerializer(r,i),o=this.getSerializedAttributeName(r);o!==t&&(e[o]=s?s.serialize(n):this.serializeData(n))},s.prototype.serialize=function(t){var e=angular.copy(t),r=this;return angular.isObject(e)&&angular.forEach(this.customSerializedAttributes,function(n,i){angular.isArray(e)?angular.forEach(e,function(e,s){var o=n;angular.isFunction(n)&&(o=o.call(e,e)),r.serializeAttribute(e,i,o,t)}):(angular.isFunction(n)&&(n=n.call(t,t)),r.serializeAttribute(e,i,n,t))}),e=this.serializeData(e)},s.prototype.deserializeData=function(t,e,r){var n=t,i=this;if(angular.isArray(t))n=[],angular.forEach(t,function(t){n.push(i.deserializeData(t,e,r))});else if(angular.isObject(t)){if(angular.isDate(t))return t;n={},e&&(n=new e.config.resourceConstructor),this.deserializeObject(n,t,r)}return n},s.prototype.deserializeObject=function(t,e,r){var n=this;return angular.forEach(e,function(r,i){n.deserializeAttribute(t,i,r,e)}),r&&t.constructor.runInterceptorPhase&&t.constructor.runInterceptorPhase("afterDeserialize",t),e},s.prototype.deserializeAttribute=function(e,r,n,i){var s,o,u=this.getDeserializedAttributeName(r);u!==t&&(s=this.getAttributeSerializer(u,i),o=this.getNestedResource(u,i),this.preservedAttributes[u]?e[u]=n:e[u]=s?s.deserialize(n,o,!0):this.deserializeData(n,o,!0))},s.prototype.deserialize=function(t,e,r){return this.deserializeData(t,e,r)},s.prototype.pluralize=function(t){return this.options.pluralize?this.options.pluralize(t):t},s.prototype.underscore=function(t){return this.options.underscore?this.options.underscore(t):t},s.prototype.camelize=function(t){return this.options.camelize?this.options.camelize(t):t},s}return e.underscore=e.underscore||n.underscore,e.camelize=e.camelize||n.camelize,e.pluralize=e.pluralize||n.pluralize,s.defaultOptions=e,s}]})}(),angular.module("rails").factory("railsRootWrapper",function(){return{wrap:function(t,e){var r={};return r[angular.isArray(t)?e.config.pluralName:e.config.name]=t,r},unwrap:function(t,e,r){return t.data&&t.data.hasOwnProperty(e.config.name)?t.data=t.data[e.config.name]:t.data&&t.data.hasOwnProperty(e.config.pluralName)&&!r&&(t.data=t.data[e.config.pluralName]),t}}}),angular.module("rails").provider("RailsResource",function(){var t={rootWrapping:!0,updateMethod:"put",httpConfig:{},defaultParams:void 0,underscoreParams:!0,fullResponse:!1,singular:!1,extensions:[]};this.rootWrapping=function(e){return t.rootWrapping=e,this},this.updateMethod=function(e){return t.updateMethod=e,this},this.httpConfig=function(e){return t.httpConfig=e,this},this.defaultParams=function(e){return t.defaultParams=e,this},this.underscoreParams=function(e){return t.underscoreParams=e,this},this.fullResponse=function(e){return t.fullResponse=e,this},this.extensions=function(){return t.extensions=[],angular.forEach(arguments,function(e){t.extensions=t.extensions.concat(e)}),this},this.$get=["$http","$q","$timeout","railsUrlBuilder","railsSerializer","railsRootWrapper","RailsResourceInjector",function(e,r,n,i,s,o,u){function a(t){if(t){var e=this.constructor.deserialize({data:t});this.constructor.config.rootWrapping&&(e=o.unwrap(e,this.constructor,!0)),angular.extend(this,e.data),this.constructor.runInterceptorPhase("afterDeserialize",this)}}return a.extendTo=function(t){function e(){this.constructor=t}return angular.forEach(this,function(e,r){t[r]=e}),angular.isArray(this.$modules)&&(t.$modules=this.$modules.slice(0)),e.prototype=this.prototype,t.prototype=new e,t.__super__=this.prototype,t},a.extend=function(){return angular.forEach(arguments,function(t){p(this,this,t,function(t,e){angular.isFunction(e.extended)&&e.extended(t)})},this),this},a.include=function(){return angular.forEach(arguments,function(t){p(this,this.prototype,t,function(t,e){angular.isFunction(e.included)&&e.included(t)})},this),this},a.configure=function(e){var r,n;return e=e||{},this.config&&(e=angular.extend({},this.config,e)),this.config={},this.config.idAttribute=e.idAttribute||"id",this.config.url=e.url,this.config.rootWrapping=h(e.rootWrapping,t.rootWrapping),this.config.httpConfig=e.httpConfig||t.httpConfig,this.config.httpConfig.headers=angular.extend({Accept:"application/json","Content-Type":"application/json"},this.config.httpConfig.headers||{}),this.config.defaultParams=e.defaultParams||t.defaultParams,this.config.underscoreParams=h(e.underscoreParams,t.underscoreParams),this.config.updateMethod=(e.updateMethod||t.updateMethod).toLowerCase(),this.config.fullResponse=h(e.fullResponse,t.fullResponse),this.config.singular=e.singular||t.singular,this.config.requestTransformers=e.requestTransformers?e.requestTransformers.slice(0):[],this.config.responseInterceptors=e.responseInterceptors?e.responseInterceptors.slice(0):[],this.config.afterResponseInterceptors=e.afterResponseInterceptors?e.afterResponseInterceptors.slice(0):[],this.config.interceptors=e.interceptors?e.interceptors.slice(0):[],this.config.serializer=u.getService(e.serializer||s()),this.config.name=this.config.serializer.underscore(e.name),this.config.name&&(this.config.pluralName=this.config.serializer.underscore(e.pluralName||this.config.serializer.pluralize(this.config.name))),this.config.urlBuilder=i(this.config),this.config.resourceConstructor=this,this.extend.apply(this,(r=(e.extensions||[]).concat(t.extensions),n=[],angular.forEach(r,function(t){t="RailsResource"+t.charAt(0).toUpperCase()+t.slice(1)+"Mixin",n.push(u.getDependency(t))}),n)),angular.forEach(this.$mixins,function(t){angular.isFunction(t.configure)&&t.configure(this.config,e)},this),this.config},a.setUrl=function(t){this.configure({url:t})},a.buildUrl=function(t){return this.config.urlBuilder(t)},a.addInterceptor=function(t){this.config.interceptors.push(t)},a.intercept=function(t,e){var r={};e=u.getDependency(e),r[t]=function(t,r,n){return e(t,r,n)||t},this.addInterceptor(r)},a.interceptBeforeRequest=function(t){this.intercept("beforeRequest",t)},a.interceptBeforeRequestWrapping=function(t){this.intercept("beforeRequestWrapping",t)},a.interceptRequest=function(t){this.intercept("request",t)},a.interceptBeforeResponse=function(t){this.intercept("beforeResponse",t)},a.interceptBeforeResponseDeserialize=function(t){this.intercept("beforeResponseDeserialize",t)},a.interceptResponse=function(t){this.intercept("response",t)},a.interceptAfterResponse=function(t){this.intercept("afterResponse",t)},a.interceptAfterDeserialize=function(t){this.intercept("afterDeserialize",t)},a.beforeResponse=function(t){t=u.getDependency(t),this.interceptResponse(function(e,r,n){return t(e.data,r.config.resourceConstructor,n),e})},a.afterResponse=function(t){t=u.getDependency(t),this.interceptAfterResponse(function(e,r,n){return t(e,r.config.resourceConstructor,n),e})},a.beforeRequest=function(t){t=u.getDependency(t),this.interceptBeforeRequestWrapping(function(e,r){return e.data=t(e.data,r.config.resourceConstructor)||e.data,e})},a.serialize=function(t){return t.data&&(t.data=this.config.serializer.serialize(t.data)),t},a.deserialize=function(t){return t.data=this.config.serializer.deserialize(t.data,this.config.resourceConstructor),t},a.callResponseInterceptors=function(t,e){var r=this.config;return l(r.responseInterceptors,function(n){t.resource=r.resourceConstructor,t.context=e,t=n(t)}),t},a.callAfterResponseInterceptors=function(t){var e=this.config;return l(e.afterResponseInterceptors,function(r){t.resource=e.resourceConstructor,t=r(t)}),t},a.runInterceptorPhase=function(t,e,n){n=n||r.resolve(e);var i=this.config,s=[];for(l(i.interceptors,function(e){(e[t]||e[t+"Error"])&&s.push(e[t],e[t+"Error"])});s.length;){var o=s.shift(),u=s.shift();n=n.then(f(o,i.resourceConstructor,e),g(u,i.resourceConstructor,e))}return n},a.$http=function(t,i,s){var u,a,c=angular.extend(angular.copy(this.config),s||{}),p=c.resourceConstructor,h=r.defer();return t&&t.timeout&&(t.timeout>0?u=n(h.resolve,t.timeout):angular.isFunction(t.timeout.then)&&t.timeout.then(h.resolve)),t=angular.extend({},t,{timeout:h.promise}),a=r.when(t),c.skipRequestProcessing?a=e(t):(a=this.runInterceptorPhase("beforeRequest",i,a).then(function(t){return t=p.serialize(t),l(c.requestTransformers,function(e){t.data=e(t.data,c.resourceConstructor)}),t}),a=this.runInterceptorPhase("beforeRequestWrapping",i,a),c.rootWrapping&&(a=a.then(function(t){return t.data=o.wrap(t.data,c.resourceConstructor),t})),a=this.runInterceptorPhase("request",i,a).then(function(t){return e(t)})),u&&(a=a.then(function(t){return n.cancel(u),t},function(t){return n.cancel(u),r.reject(t)})),a=this.runInterceptorPhase("beforeResponse",i,a).then(function(t){return t.originalData=t.data,t}),c.rootWrapping&&(a=a.then(function(t){return o.unwrap(t,c.resourceConstructor,!1)})),a=this.runInterceptorPhase("beforeResponseDeserialize",i,a).then(function(t){return p.deserialize(t)}),a=this.callResponseInterceptors(a,i),a=this.runInterceptorPhase("response",i,a).then(function(t){return i&&t.hasOwnProperty("data")&&angular.isObject(t.data)&&angular.extend(i,t.data),c.fullResponse?t:i||t.data}),a=this.callAfterResponseInterceptors(a,i),a=this.runInterceptorPhase("afterResponse",i,a),function t(e,r){var n=e.then;return e.then=function(e,i,s){var o=n.apply(this,arguments);return t(o,r)},angular.extend(e,r),e}(a=this.runInterceptorPhase("afterDeserialize",i,a),{resource:c.resourceConstructor,context:i,abort:function(){h.resolve()}})},a.processParameters=function(t){var e={};return angular.isObject(t)&&this.config.underscoreParams?(angular.forEach(t,function(t,r){e[this.config.serializer.underscore(r)]=t},this),e):t},a.getParameters=function(t){var e;return this.config.defaultParams&&(e=angular.copy(this.config.defaultParams)),angular.isObject(t)&&(e=angular.extend(e||{},t)),this.processParameters(e)},a.getHttpConfig=function(t){var e=this.getParameters(t);return e?angular.extend({params:e},this.config.httpConfig):angular.copy(this.config.httpConfig)},a.$url=a.resourceUrl=function(t,e){var r=t;return angular.isObject(t)||((r={})[this.config.idAttribute]=t),c(this.buildUrl(r||{}),e)},a.$get=function(t,e){return this.$http(angular.extend({method:"get",url:t},this.getHttpConfig(e)))},a.query=function(t,e){return this.$get(this.resourceUrl(e),t)},a.get=function(t,e){return this.$get(this.resourceUrl(t),e)},a.prototype.$url=function(t){return c(this.constructor.resourceUrl(this),t)},a.prototype.$http=function(t,e){return this.constructor.$http(t,this,e)},angular.forEach(["post","put","patch"],function(t){a["$"+t]=function(e,r,n,i){return r=angular.copy(r),this.$http(angular.extend({method:t,url:e,data:r},this.getHttpConfig(i)),null,n)},a.prototype["$"+t]=function(e,r,n){var i=angular.copy(this,{});return this.constructor.$http(angular.extend({method:t,url:e,data:i},this.constructor.getHttpConfig(n)),this)}}),a.prototype.create=function(){return this.$post(this.$url(),this)},a.prototype.update=function(){return this["$"+this.constructor.config.updateMethod](this.$url(),this)},a.prototype.get=function(){return this.constructor.$http(angular.extend({method:"GET",url:this.$url()},this.constructor.getHttpConfig()),this)},a.prototype.isNew=function(){var t=this.constructor.config.idAttribute;return angular.isUndefined(this[t])||null===this[t]},a.prototype.save=function(){return this.isNew()?this.create():this.update()},a.$delete=function(t,e){return this.$http(angular.extend({method:"delete",url:t},this.getHttpConfig(e)))},a.prototype.$delete=function(t,e){return this.constructor.$http(angular.extend({method:"delete",url:t},this.constructor.getHttpConfig(e)),this)},a.prototype.remove=a.prototype.delete=function(){return this.$delete(this.$url())},a;function c(t,e){return e&&("/"!==e[0]&&(t+="/"),t+=e),t}function l(t,e){for(var r,n=0,i=t.length;n<i;n++)r=t[n],angular.isString(r)&&(r=t[n]=u.getDependency(r)),e(r)}function p(t,e,r,n){var i=["included","extended,","configure"];t.$mixins||(t.$mixins=[]),angular.isString(r)&&(r=u.getDependency(r)),r&&-1===t.$mixins.indexOf(r)&&(angular.forEach(r,function(t,r){-1===i.indexOf(r)&&(e[r]=t)}),t.$mixins.push(r),angular.isFunction(n)&&n(t,r))}function h(t,e){return angular.isUndefined(t)?e:t}function f(t,e,r){return function(n){return(t||angular.identity)(n,e,r)}}function g(t,e,n){return function(i){return t?t(i,e,n):r.reject(i)}}}]}),angular.module("rails").factory("railsResourceFactory",["RailsResource",function(t){return function(e){function r(){r.__super__.constructor.apply(this,arguments)}return t.extendTo(r),r.configure(e),r}}]);